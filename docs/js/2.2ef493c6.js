(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[2],{"083d":function(t,a,e){},"1d0e":function(t,a,e){"use strict";e.r(a);var i=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("q-page",{staticClass:"flex flex-center map-wrapper"},[e("div",{attrs:{id:"container"}}),e("q-dialog",{attrs:{persistent:"","no-esc-dismiss":""},model:{value:t.visible,callback:function(a){t.visible=a},expression:"visible"}},[e("div",[e("alarmForm",{attrs:{id:t.drawingOverlayId},on:{onSubmit:t.saveAlarmInfo,cancelEdit:t.cancelEdit}})],1)]),t.hasInfoAlarmOverlayList.length>0?e("q-card",{staticClass:"list-wrapper"},[e("div",{staticClass:"title"},[t._v("报警区域列表")]),t._l(t.hasInfoAlarmOverlayList,(function(a,i){return e("div",{key:a.id,staticClass:"list-item"},[t._v("\n      "+t._s(i+1)+"-报警区域名称:"+t._s(a.info?a.info.alarmName:"-")+"\n      编号:"+t._s(a.info?a.info.alarmNo:"-")+"\n    ")])}))],2):t._e(),e("q-card",{class:["search-wrapper",{"gt-xs":t.showSearchFlag}]},[e("div",{staticClass:"flex"},[e("label",{attrs:{for:""}},[t._v("经度:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.point.lng,expression:"point.lng"}],attrs:{type:"text"},domProps:{value:t.point.lng},on:{input:function(a){a.target.composing||t.$set(t.point,"lng",a.target.value)}}})]),e("div",{staticClass:"flex"},[e("label",{attrs:{for:""}},[t._v("纬度:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.point.lat,expression:"point.lat"}],attrs:{type:"text"},domProps:{value:t.point.lat},on:{input:function(a){a.target.composing||t.$set(t.point,"lat",a.target.value)}}})]),e("button",{on:{click:t.searchPoint}},[t._v("查询")])]),e("q-page-sticky",{staticClass:"xs",attrs:{position:"bottom-right",offset:[18,18]}},[e("q-btn",{attrs:{fab:"",color:"blue-5","text-color":"grey-1",icon:"search",direction:"left"},on:{click:function(a){t.showSearchFlag=!t.showSearchFlag}}})],1)],1)},r=[],n=e("4082"),l=e.n(n),s=e("ded3"),o=e.n(s),c=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("q-form",{staticClass:"q-gutter-md q-pa-md",on:{submit:t.onSubmit}},[e("q-input",{attrs:{filled:"",label:"区域名称",rules:[function(t){return t&&t.length>0||"请输入"}]},model:{value:t.formData.alarmName,callback:function(a){t.$set(t.formData,"alarmName",a)},expression:"formData.alarmName"}}),e("q-input",{attrs:{filled:"",label:"区域编号",rules:[function(t){return t&&t.length>0||"请输入"}]},model:{value:t.formData.alarmNo,callback:function(a){t.$set(t.formData,"alarmNo",a)},expression:"formData.alarmNo"}}),e("q-input",{attrs:{filled:"",label:"区域描述",rules:[function(t){return t&&t.length>0||"请输入"}]},model:{value:t.formData.alarmDesc,callback:function(a){t.$set(t.formData,"alarmDesc",a)},expression:"formData.alarmDesc"}}),e("div",[e("q-btn",{attrs:{label:"确定",type:"submit",color:"primary"}}),e("q-btn",{staticClass:"q-ml-sm",attrs:{label:"取消",color:"primary",flat:""},on:{click:t.onReset}})],1)],1)},m=[],d={data(){return{formData:{}}},components:{},methods:{onSubmit(){this.$emit("onSubmit",this.formData)},onReset(){this.$emit("cancelEdit")}},props:{id:{type:String}}},p=d,v=(e("92fa"),e("2877")),h=e("0378"),f=e("27f9"),g=e("9c40"),u=e("eebe"),y=e.n(u),O=Object(v["a"])(p,c,m,!1,null,"1f2fb2de",null),x=O.exports;y()(O,"components",{QForm:h["a"],QInput:f["a"],QBtn:g["a"]});e("5319");const b=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var a=16*Math.random()|0,e="x"==t?a:3&a|8;return e.toString(16)}));var w={name:"mapProject",data(){return{alarmOverlayList:[],map:void 0,styleOptions:{strokeColor:"red",fillColor:"red",strokeWeight:3,strokeOpacity:.8,fillOpacity:.6,strokeStyle:"solid"},visible:!1,drawingOverlayId:void 0,drawingManager:void 0,point:{lng:"",lat:""},showSearchFlag:!0}},mounted(){this.init()},components:{alarmForm:x},computed:{hasInfoAlarmOverlayList(){return this.alarmOverlayList.filter((t=>t.info))}},methods:{init(){const t=localStorage.getItem("overlay_info");t&&t.length>0?(this.alarmOverlayList=JSON.parse(t),this.initMap(),this.updateOverlay()):this.initMap()},initMap(){this.map=new BMap.Map("container"),this.map.centerAndZoom(new BMap.Point(116.404,39.915),15),this.drawingManager=new BMapLib.DrawingManager(this.map,{isOpen:!1,enableDrawingTool:!0,drawingToolOptions:{anchor:BMAP_ANCHOR_TOP_RIGHT,offset:new BMap.Size(5,5),drawingModes:[BMAP_DRAWING_CIRCLE,BMAP_DRAWING_POLYGON]},circleOptions:this.styleOptions,polygonOptions:this.styleOptions}),this.drawingManager.addEventListener("overlaycomplete",this.overlaycomplete)},overlaycomplete(t){if(window.width<768)return;const{overlay:a,drawingMode:e}=t;this.drawingManager.close();let i={};const r=b();if(this.drawingOverlayId=r,"polygon"===e){const t=a.getPath();i={path:t,drawingMode:e,id:r,overlay:a}}else{const{point:t,Fa:n}=a;i={point:t,drawingMode:e,radius:n,id:r,overlay:a}}a.addEventListener("rightclick",(t=>this.deleteOverlay(t,i))),this.alarmOverlayList.push(i),this.visible=!0},updateOverlay(){this.alarmOverlayList=this.alarmOverlayList.map((t=>{const a=this.getOverlay(t);return a.addEventListener("rightclick",(a=>this.deleteOverlay(a,t))),o()(o()({},t),{},{overlay:a})})),this.alarmOverlayList.forEach((t=>{this.map.addOverlay(t.overlay)}))},getOverlay(t){const{drawingMode:a}=t;if("polygon"===a){const a=t.path.map((t=>new BMap.Point(t.lng,t.lat)));return new BMap.Polygon(a,this.styleOptions)}return new BMap.Circle(t.point,t.radius,this.styleOptions)},saveAlarmInfo(t){const a=this.alarmOverlayList.findIndex((t=>t.id===this.drawingOverlayId)),e=o()(o()({},this.alarmOverlayList[a]),{},{info:t});this.alarmOverlayList.splice(a,1,e),this.visible=!1;const i=this.alarmOverlayList.map((t=>{const{overlay:a}=t,e=l()(t,["overlay"]);return e}));localStorage.setItem("overlay_info",JSON.stringify(i))},cancelEdit(){const t=this.alarmOverlayList.findIndex((t=>t.id===this.drawingOverlayId)),{overlay:a}=this.alarmOverlayList[t];this.alarmOverlayList.splice(t,1),this.map.removeOverlay(a),this.visible=!1},deleteOverlay(t,a){this.$q.dialog({title:"Confirm",message:a.info?`确定要删除${a.info.alarmNo}-${a.info.alarmName}报警区域吗？`:"确定删除该报警区域吗？",color:"negative",ok:"确定",cancel:"取消"}).onOk((()=>{this.map.removeOverlay(t.target);const e=this.alarmOverlayList.findIndex((t=>t.id===a.id));this.alarmOverlayList.splice(e,1);const i=this.alarmOverlayList.map((t=>{const{overlay:a}=t,e=l()(t,["overlay"]);return e}));localStorage.setItem("overlay_info",JSON.stringify(i))}))},searchPoint(){const t=new BMap.Point(this.point.lng,this.point.lat);let a=[],e="";this.alarmOverlayList.forEach((e=>{const{drawingMode:i,overlay:r}=e;let n;switch(i){case"polygon":n=BMapLib.GeoUtils.isPointInPolygon(t,r);break;case"circle":n=BMapLib.GeoUtils.isPointInCircle(t,r);break;default:break}n&&a.push(`${e.info.alarmNo}-${e.info.alarmName}`)})),e=a.length>0?`坐标：经度${this.point.lng}纬度${this.point.lat}的点在以下报警区域：${a.join(",")}`:"未在报警区域内",this.$q.dialog({title:"查询结果",message:e,ok:"确定"})}}},L=w,M=(e("cad0"),e("9989")),k=e("24e8"),_=e("f09f"),I=e("de5e"),N=Object(v["a"])(L,i,r,!1,null,"0036dbe3",null);a["default"]=N.exports;y()(N,"components",{QPage:M["a"],QDialog:k["a"],QCard:_["a"],QPageSticky:I["a"],QBtn:g["a"]})},"92fa":function(t,a,e){"use strict";e("083d")},cad0:function(t,a,e){"use strict";e("cb48")},cb48:function(t,a,e){}}]);